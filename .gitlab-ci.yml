include:
  local: .base-gitlab-ci.yml

stages:
  - build
  - test
  - sonarqube

sonarqube:
  stage: sonarqube
  when: always
  needs:
    - test
  allow_failure: false
  cache:
    key: "${CI_JOB_NAME}"
    paths:
      - .sonar/cache
  script:
    - gradle jacocoTestReport --daemon
    - gradle sonarqube --stacktrace --daemon
  only:
    - main
    - merge_requests